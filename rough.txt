import { CommonModule } from '@angular/common';
import { Component, OnInit } from '@angular/core';
import { FormArray, FormControl, FormGroup, ReactiveFormsModule, Validators } from '@angular/forms';

@Component({
  selector: 'app-profile',
  standalone: true,
  imports: [ReactiveFormsModule, CommonModule],
  templateUrl: './profile.component.html',
  styleUrls: ['./profile.component.css']
})
export class ProfileComponent implements OnInit {
  myForm!: FormGroup;

  ngOnInit() {
    this.myForm = new FormGroup({
      phone: new FormArray([
        new FormControl('', [
          Validators.required,
          Validators.pattern(/^[0-9]{10}$/)
        ])
      ])
    });
  }

  checkFormStatus() {
    return this.phone.controls.some((control) => control.invalid && control.touched);
  }

  removeFields(index: number) {
    this.phone.removeAt(index);
    if (this.phone.length === 0) {
      this.addNumberFields(); // Ensure at least one field remains
    }
  }

  addNumberFields() {
    this.phone.push(
      new FormControl('', [
        Validators.required,
        Validators.pattern(/^[0-9]{10}$/)
      ])
    );
  }

  get phone() {
    return this.myForm.get('phone') as FormArray;
  }
}

-----

<form [formGroup]="myForm">
    <button type="button" (click)="addNumberFields()" id="add-phone-button">
        Add Phone Number
    </button>

    <ng-container formArrayName="phone" *ngFor="let control of phone.controls; let i = index">
        <div>
            <label for="phone-input-{{ i }}">Enter Phone Number:</label>
            <input type="number" [formControlName]="i" id="phone-input-{{ i }}" name="phone-input" />
            <button type="button" (click)="removeFields(i)" id="remove-phone-button-{{ i }}" *ngIf="phone.length > 1">
                Remove
            </button>
        </div>

        <span *ngIf="control.invalid && control.touched" class="error" id="phone-error-{{ i }}">
            Phone number must be 10 digits.
        </span>
    </ng-container>

    <div *ngIf="checkFormStatus()" class="error">
        At least one valid phone number is required.
    </div>
</form>